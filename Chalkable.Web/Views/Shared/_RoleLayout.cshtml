@using Chalkable.Web.Common

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  itemscope itemtype="Education">
<head>
    <title>@ViewBag.Title</title>
    @ChlkHelpers.RenderPageMetadata()
    <meta itemprop="image" content="@Url.Content("~/favicon.ico")">
    <link rel="icon" href="@Url.Content("~/favicon.ico")" />
    <!--Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Reenie+Beanie' rel='stylesheet' type='text/css' />
    <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css' />
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css' />
    <!-- Whole Site CSS -->
    <link href="@Url.StaticContent("/Content/screen.css")" rel="stylesheet" media="screen, projection" type="text/css" />
    <link href="@Url.StaticContent("/app/jquery/choosen/chosen.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.StaticContent("/app/jquery/datepicker/jquery-ui-1.10.3.custom.css")" rel="stylesheet" type="text/css" />
    <!-- Page specific CSS -->
    @RenderSection("Styles", false)
    @if(!Chalkable.Web.Tools.CompilerHelper.IsDebug)
    {
        ChlkHelpers.GoogleAnalytics();
        ChlkHelpers.Olark();
    }
    @ChlkHelpers.RenderSiteRoot(Url)
    <script type="text/javascript" src="@Url.StaticContent("/app/chlk/shared.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/chlk/chlk-messages.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/jquery-2.0.2.min.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/jquery.autosize-min.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/choosen/chosen.jquery.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/datepicker/jquery-ui-1.10.3.custom.min.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/validation/languages/jquery.validationEngine-en.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/jquery/validation/jquery.validationEngine.js")"></script>
    <script type="text/javascript" src="@Url.StaticContent("/app/api/chlk-post-message-api.js")"></script>
        

</head>
    <body>
        <div id="fb-root"></div>
        <input type="hidden" value=" ServerTime :  @ViewData.GetValueOrNull("CurrentServerDateTime")"/>
        <input type="hidden" value=" ServerDbTime:  @ViewData.GetValueOrNull("CurrentServerDBDateTime")"/>

        <div id="page-header">
            Revision: @Chalkable.Web.Tools.CompilerHelper.Version
        </div>

        <div id="logout-block"></div>
   

        @{
            var isDeveloper = (ViewData.ContainsKey(ViewConstants.IS_DEV) && (bool)ViewData[ViewConstants.IS_DEV]);
            var isDemoSchool = !string.IsNullOrEmpty((string)ViewData.GetValueOrNull("Prefix"));
            var needsTour = !string.IsNullOrEmpty(Convert.ToString(ViewData.GetValueOrNull(ViewConstants.NEEDS_TOUR)));
        }
        
        

    

        <div class="page 
        @if (isDemoSchool || isDeveloper)
        {
            @:demo
        }
        ">
            <div id="sidebar"></div>
            <div id="content">
                <div class="ribbon"></div>
                <div id="content-wrapper">
                    <div id="main-top">
                    </div>
                    <div id="main-wrapper">
                        <div id="main">
                            @RenderBody()
                       
                        </div>
                        <div id = "chlk-dialogs" class = "x-hidden"></div>
                    </div>
                    @ChlkHelpers.RenderChlkCopyrightYear()
                </div>
            </div>
            
            
        </div>
        @if (isDemoSchool || isDeveloper)
        {
            <div id="demo-footer" class="top"></div>
        }
        <div id = "chlk-overlay" class ="x-hidden"></div>
        <div id="chlk-pop-up-container" class="x-hidden">
            <div id="pop-up-triangle"></div>
        </div>
        <div class="chlk-tooltip" id="chlk-tooltip-item">
            <div class="tooltip-content"></div>
            <div class="tooltip-triangle"></div>
        </div>
        @RenderSection("MixPanelTracking", false)
        
        
        
        
       
        
   
    
    
<script type="text/json" id="application-value" class="valuable-script">
    @Html.Raw(@ViewData.GetValueOrNull(ViewConstants.DEFAULT_APPLICATION))
</script>

    <script type="text/json" id="applications-value" class="valuable-script">
    @Html.Raw(@ViewData.GetValueOrNull(ViewConstants.APPLICATIONS))
</script>

<script type="text/javascript">
    var values = document.getElementsByClassName('valuable-script'), value, name;
    var len = values.length;
    for (var i = 0; i < len; i++) {
        value = values[i];
        if (value.text.trim()) {
            name = value.getAttribute('id').split('-')[0];
            window[name] = JSON.parse(value.text).data;
        }
    }
</script>
        <script type="">
        
        function parseJsonToObj(json){
            return json ? JSON.parse(HtmlEncode(json)).data : null;
        }
        function parseJsonToArray(json){
            return parseJsonToObj(json) || [];
        }

        var school = parseJsonToObj('@ViewData.GetValueOrNull(ViewConstants.SCHOOL)'); 
        var newNotifications = parseInt('@ViewData.GetValueOrNull(ViewConstants.UNSHOWN_NOTIFICATIONS_COUNT)', 10) || 0;
        var azurePictureUrl = '@ViewData.GetValueOrNull(ViewConstants.AZURE_PICTURE_URL)';

        var USER_ROLE_EXT = '@ViewData.GetValueOrNull("Rolename")';
        var currentChlkPerson = parseJsonToObj('@ViewData.GetValueOrNull(ViewConstants.CURRENT_PERSON)');
        var classesToFilter = parseJsonToArray('@ViewData.GetValueOrNull(ViewConstants.CLASSES)');
        var classesAdvancedData = parseJsonToArray('@ViewData.GetValueOrNull(ViewConstants.CLASSES_ADV_DATA)');
        var scriptsRoot = '@Chalkable.Web.Tools.CompilerHelper.ScriptsRoot';
        var classesInfo = {};
        classesAdvancedData && classesAdvancedData.forEach(function (el) {
            classesInfo[el.classid] = {
                mask: el.mask,
                typesByClass: el.typesbyclass
            };
        });

        var markingPeriod =  parseJsonToObj('@ViewData.GetValueOrNull(ViewConstants.MARKING_PERIOD)');
        var nextMarkingPeriod = parseJsonToObj('@ViewData.GetValueOrNull(ViewConstants.NEXT_MARKING_PERIOD)'); 
        var finalizedClassesIds = parseJsonToArray('@ViewData.GetValueOrNull(ViewConstants.FINALIZED_CLASSES_IDS)'); 
        var attendanceReasons = parseJsonToArray('@ViewData.GetValueOrNull(ViewConstants.ATTENDANCE_REASONS)');
        var gradeLevels = parseJsonToArray('@ViewData.GetValueOrNull(ViewConstants.GRADE_LEVELS)');

    </script>
    
    @if (Chalkable.Web.Tools.CompilerHelper.IsDebug)
    {
        <script src="@Url.Content("~/app/ria/_bootstrap.js")" type="text/javascript">
            ria.__CFG = {
                "prettyStackTraces": true,
                "checkedMode": true,
                "enablePipelineMethodCall": true,
                "AssertWithExceptions": false,
                "stackTraceJs": "lib/stacktrace.js",

                "#require": {
                    "plugins": ["~/assets/jade.js"],
                    "appCodeDir": "~/app/",
                    "appRoot": "@Url.Content("~")",
                    "libs": {
                        }
                },

                "#mvc": @RenderSection("MVCSettings", false)
            }
        </script>
    }
    else
    {
        <script type="text/javascript">
            var roleAppScript = '@Chalkable.Web.Tools.CompilerHelper.ScriptsRoot' + '/app/' + currentChlkPerson.role.name + 'App.compiled.js';
            (function(appUrl) {
                var scr = document.createElement('script');
                scr.setAttribute('type', 'text/javascript');
                scr.src = appUrl;
                
                var cfgObject = {
                    "prettyStackTraces": true,
                    "checkedMode": false,
                    "enablePipelineMethodCall": true,
                    "AssertWithExceptions": true,
                    "#mvc": @RenderSection("MVCSettings", false)
                };

                cfgObject = JSON.stringify(cfgObject);
                scr.innerHTML = "ria.__CFG = " + cfgObject;
                document.getElementsByTagName('head').item(0).appendChild(scr);
            })(roleAppScript);
        </script>
    }
    
    @RenderSection("BottomScripts", false)
    
    
    
    </body> 
</html>