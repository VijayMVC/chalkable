mixin MealItemCell(mealItem, mealIndex, curIndex)
    .cell.meal-item-td
        +Hidden("lunchCounts." + curIndex + ".staffId", (mealItem.type == chlk.templates.classes.LunchCountItemType.STAFF) ? mealItem.info.getId().valueOf() : null)
        +Hidden("lunchCounts." + curIndex + ".studentId", (mealItem.type == chlk.templates.classes.LunchCountItemType.STUDENT) ? mealItem.info.getId().valueOf() : null)
        +Hidden("lunchCounts." + curIndex + ".date", lunchCountInfo.getDate().toStandardFormat())
        +Hidden("lunchCounts." + curIndex + ".mealTypeId", tableInfo.mealItems[mealIndex].getMealType().getId().valueOf())
        input(
            name="lunchCounts." + curIndex + ".count",
            type="text",
            value=mealItem.getCount(),
            data-index=curIndex
        ).meal-count-input

-var clazz = self.getClazz()
-var lunchCountInfo = clazz.getLunchCountInfo()
-var tableInfo = self.getTableInfo()
.profile-page.class-profile
    h2.page-title=clazz.getName()
    +ProfileTopBar(self, 'lunch')
    +ActionForm('class', 'lunchSubmit').class-lunch-form
        +Hidden('classId', clazz.getId())
        .top-date
            +DatePicker('date', lunchCountInfo.getDate())(
                data-options={
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    inCurrentGradingPeriods: true
                },
                data-controller= "class",
                data-action="lunch",
                data-params=[clazz.getId().valueOf()]
            )
        .chlk-calendar.lunch-grid
            .chlk-grid(data-meal-count = tableInfo.mealItems.length)
                .grid-content
                    .grid-header.grid-row
                        .cell.no-bodrer
                        each item in tableInfo.mealItems
                            .cell.no-bodrer.meal-item-th=item.getMealType().getName()
                    if tableInfo.topTable.length
                        each item, index in tableInfo.topTable
                            .grid-row
                                .cell.left-cell=item.info.name || item.info.getDisplayName()
                                each mealItem, mealIndex in item.mealItems
                                    -var curIndex = index * tableInfo.mealItems.length + mealIndex
                                    +MealItemCell(mealItem, mealIndex, curIndex)
                    .grid-header.grid-row.students-row
                        .cell.left-cell.no-bodrer Students
                        each item in tableInfo.mealItems
                            .cell.no-bodrer
                    if tableInfo.bottomTable.length
                        -var firstIndex = tableInfo.mealItems.length * tableInfo.topTable.length
                        each item, index in tableInfo.bottomTable
                            .grid-row
                                .cell.left-cell=item.info.getDisplayName()
                                each mealItem, mealIndex in item.mealItems
                                    -var curIndex = firstIndex + index * tableInfo.mealItems.length + mealIndex
                                    +MealItemCell(mealItem, mealIndex, curIndex)
                    .grid-header.grid-row.total-row
                        .cell.left-cell Total
                        each item in tableInfo.mealItems
                            .cell=item.getTotal()
        .x-window-footer.report-bottom
            BUTTON(type="button").close.chlk-button.grey-button=Msg.Cancel
            BUTTON(type="submit").chlk-button.blue-button Save

