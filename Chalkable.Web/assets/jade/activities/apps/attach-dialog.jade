mixin AppIconLink_(announcementId, app, iconTooltip)
    -var appId = app.getId().valueOf()
    .announcement-item.application(data-tooltip=iconTooltip)
        .wrapper
            +LoadingImage(src=app.getBannerPictureUrl(), id="loading-image-" + appId)
            .title(data-tooltip=app.getName(), data-tooltip-type="overflow")= app.getName()
            .shortdesc= app.getShortDescription()
            if app.needToInstall()
                +ActionButton('appmarket', 'details', app.getId()) Install
            else
                +ActionButton('apps', 'tryToAttachFromAnnouncement', announcementId, appId, self.getAppUrlAppend()) Attach


mixin AttachTypeButtonBlock_(imageUrl, title, typeId, controller, action, announcementId)
    .announcement-item.application(data-tooltip=title, data-tooltip-type="overflow")
        .wrapper
            +LoadingImage(src=imageUrl, id="loading-image-"+typeId)
            .title(data-tooltip=title, data-tooltip-type="overflow")=title
            .shortdesc= title
            +ActionButton(controller, action, announcementId)=title

mixin FileAttachBlock_(title, imageUrl)
    .announcement-item.application(data-tooltip=title, data-tooltip-type="overflow")
        .wrapper
            +LoadingImage(src=imageUrl, id="loading-image-file-attach")
            div.simple-gray-button.file.title=title
                +FileUpload('announcement', 'uploadAttachmentOnCreate', [announcementId])#add-file-attachment.simple-gray-button


mixin AttributeBlock_(title, imageUrl, announcementId, classId)
    .announcement-item.application(data-tooltip=title, data-tooltip-type="overflow")
        .wrapper
            +LoadingImage(src=imageUrl, id="loading-image-file-attribute")
            .shortdesc= title
            +ActionButton('announcement', 'addAttribute', announcementId, classId)=title

mixin AssessmentBlock_(title, imageUrl, announcementId, assessmentAppId)
    announcement-item.application(data-tooltip=title, data-tooltip-type="overflow")
        .wrapper
            +LoadingImage(src=imageUrl, id="loading-image-file-assessment")
            .shortdesc= title
            +ActionButton('apps', 'tryToAttachFromAnnouncement', announcementId, assessmentAppId)#add-assesment.simple-gray-button=title


//mixin StandardsBlock_(title, imageUrl

announcementId = self.getAnnouncementId() && self.getAnnouncementId().valueOf()
classId = self.getClassId() && self.getClassId().valueOf()

.dialog.attach-dialog
    .x-window-header
        h1 ATTACH
        a.close.close-btn
    .x-window-body

            .attachments-and-applications
                +FileAttachBlock_("Attach a file", "#")
                if self.isAttributesEnabled()
                    +AttributeBlock_("Attach attribute", "#", announcementId, classId)

                if self.getAssessmentAppId()
                    +AssessmentBlock_("Assessment", '#', announcementId, self.getAssessmentAppId())

                if self.isShowApps()
                    each app in self.apps.getItems()
                        +AppIconLink_(announcementId, app, self.getAppIconToolTip(app))

            if self.isShowApps()
                .paging
                    +Paginator2('announcement', 'attach', self.apps, [announcementId, classId, self.getAppUrlAppend(), self.isStandardAttachEnabled()])
