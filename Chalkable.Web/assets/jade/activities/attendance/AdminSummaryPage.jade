mixin StudentsTpl(students, header, needPlus)
    preparedStudents = self.getPreparedStudents(students, needPlus)
    length = students.length
    blockCount = 18
    h2 #{length} - #{header}
    div(attributes).all-students
        count = Math.ceil(length/blockCount)
        -for (var i = 0; i < count; i++) {
            max = length - i * blockCount
            maxIndex = max < blockCount ? max : blockCount
            div(class=(((i == count - 1) ? "last-block " : "") + ((i == 0) ? "" : "hidden-students-block no-used")))
                div.hidden-students-block-2
                    -for (var j = 0; j < maxIndex; j++) {
                        index = i*blockCount + j
                        student = students[index]
                        if !student.getId()
                            if i == 0 && j == 0
                                div(index="0").student.grey.plus
                                    .plus-container.for-plus +
                                    .name.for-plus= Msg.Add_student
                                    .small-pop-up.for-plus
                                        .container
                                            .triangle
                                            .student-search-container
                                                input.student-search-input
                                            SPAN.enter= Msg.Enter_when_done
                            else
                                div(index=index).student.grey
                                    .name
                        else
                            div(index=index, data-id=student.getId().valueOf()).student
                                .img-container
                                    +PersonImg(student, 64)
                                +ActionLink('students', 'details', student.getId()).name=student.getDisplayName()
                    -}
        -}
    if students.length > blockCount
        .more-container
            a.more-students=Msg.More_students

topData = self.getTopData();
topItems = topData.getTopItems();
selectedIds = topData.getSelectedIds();
nowData = self.getNowAttendanceData();
dayData = self.getAttendanceByDayData();
mpData = self.getAttendanceByMpData();
valuesEnum = chlk.models.attendance.AttendanceTypeEnum;
.admin-attendance.loader-container
    .loader
    +LeftRightToolbar(topItems, chlk.templates.grading.GradeLevelForTopBar, 'attendance', 'summary', [true])(
        selectedIds=selectedIds,
        multiple
    ).classes-bar
    .attendance-boxes-admin
        .boxes-container
            div(left="0px", text=Msg.Now, data-index="1").attendance-box.attendance-top-box.now-box.active
                .number=self.getNowAttendanceData().getAbsentNowCount()
                .title=Msg.Not_in_class_right_now
            div(left="192px", text=Msg.Today, data-index="2").attendance-box.attendance-top-box.day-box
                .number=self.getAttendanceByDayData().getStudentsCountAbsentWholeDay()
                .title=Msg.Attendance_today
            div(left="381px", text=Msg.Marking_Period_shortcut, data-index="3").attendance-box.attendance-top-box.mp-box
                .number=self.getAttendanceByMpData().getAbsentStudentsCountAvg()
                .title=Msg.Attendance_MP
        .slider-line-container
            .slider-left
            .slider-line
            .slider-right
            .slider-container
                .slider
                .active=Msg.Now
    .attendance-content
        .attendance-now.students-statistic.page-1.active
            if nowData.getAbsentNowStudents()
                .top-container
                    .stats.i-b
                        .attendance-box.rightnow-usually
                            .box-container
                                .number=nowData.getAbsentNowCount()
                                .title=Msg.Right_now
                            .box-container
                                .number=nowData.getAbsentUsually()
                                .title=Msg.Usually
                    .now-chart-block.i-b
                .attendance-students
                    +StudentsTpl(nowData.getAbsentNowStudents(), Msg.Absent + " " + Msg.Right_now.toLowerCase(), true)(
                        class = 'attendance-' + valuesEnum.ABSENT.valueOf()
                    )
        .attendance-day.students-statistic.page-2
            .attendance-students
                +StudentsTpl(dayData.getStudentsAbsentWholeDay(), Msg.Absent_from_school, true).absent-from-school
            div(index="1", type=valuesEnum.EXCUSED.valueOf()).attendance-students.bytype
                +StudentsTpl(dayData.getExcusedStudents(), Msg.Excused_from_a_class, true)(
                    class = 'attendance-' + valuesEnum.EXCUSED.valueOf()
                )
            div(index="2", type=valuesEnum.ABSENT.valueOf()).attendance-students.bytype
                +StudentsTpl(dayData.getAbsentStudents(), Msg.Absent_from_a_class, true)(
                    class = 'attendance-' + valuesEnum.ABSENT.valueOf()
                )
            div(index="3", type=valuesEnum.LATE.valueOf()).attendance-students.bytype
                +StudentsTpl(dayData.getLateStudents(), Msg.Late_to_a_class, true)(
                    class = 'attendance-' + valuesEnum.LATE.valueOf()
                )
        .attendance-mp.students-statistic.page-3
            .attendance-students.mp-students
                +StudentsTpl(mpData.getAbsentAndLateStudents(), Msg.Students_with_attendance_issues).attendance-mp


