mixin Glue_()
    =[].slice.call(arguments).filter(function (_) { return !/^\s*$/.test(_||'') }).join(' - ')

mixin FeedItem(item, disabled, isStudentGrading)
    -VALIDATE_ARG('item', [chlk.models.announcement.FeedAnnouncementViewData, chlk.templates.announcement.AnnouncementView, chlk.models.announcement.Announcement], item)
    -VALIDATE_ARG('disabled_', [Boolean], disabled)

    -var adminAnnouncement = item.getAdminAnnouncementData()
    -var classAnnouncement = item.getClassAnnouncementData()
    -var lessonPlan = item.getLessonPlanData()
    -var itemClasses = attributes['class'] || []

    - itemClasses.push(adminAnnouncement ? 'is-admin' : (lessonPlan ? 'lesson-plan' : 'class-announcement'))
    - itemClasses.push(item.getOwnerAttachmentsCount() > 0 || item.getApplicationsCount() > 0 ? 'has-attachments' : 'no-attachments')
    - itemClasses.push(item.isShowGradingIcon() ? 'is-gradable' : 'non-gradable')
    - itemClasses.push(item.getOwnerAttachmentsCount() == 0 ? 'no-attachment-icon' : 'has-attachments-icon')

    - itemClasses.push(item.isHiddenFromStudents() ? 'invisible-for-students' : 'visible-for-students')
    -if (item.isComplete())           itemClasses.push('complete')
    -if (item.getApplicationsCount()) itemClasses.push('app-icon')

    div(class = itemClasses).feed-item
        +ActionLink('announcement', isStudentGrading ? 'starFromStudentGrades' : 'star', item.getId().valueOf(), false)(data-tooltip=Msg.Done).star.complete
        +ActionLink('announcement', isStudentGrading ? 'starFromStudentGrades' : 'star', item.getId().valueOf(), true)(data-tooltip= Msg.ToDo).star
        +ActionLink('announcement', 'view', item.getId(), item.getType())(class = disabled ? 'disabled' : '').announcement-link
            if adminAnnouncement
                .title: +Glue_(item.getTitle() || Msg.Admin_Announcement, "")
            if classAnnouncement
                .title: +Glue_(item.getAnnouncementTypeName(), classAnnouncement.getClassName())
            if lessonPlan
                .title: +Glue_(lessonPlan.getClassName(), Msg.Lesson_Plan)
            if lessonPlan
                -console.info(lessonPlan.getEndDate())
                .date= (lessonPlan.getStartDate() && lessonPlan.getStartDate().format('From M d, to')) + (lessonPlan.getEndDate() && lessonPlan.getEndDate().format('M d'))
                .attachment
                    .grades
                        .visible
                            .content
                                .line
                                    .inner-line(style="width:" + lessonPlan.getPercents() + "%;")
                                .right-text #{lessonPlan.getPercents()}%
            else
                -var announcementItem = classAnnouncement || adminAnnouncement
                .date= announcementItem.getExpiresDate() ? announcementItem.getExpiresDate().toString('m/d/y') : ''
                .attachment
                    .grades
                        .visible
                            .content: +Glue_(item.getTitle(), item.getShortContent())
